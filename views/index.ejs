<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>SonoLite</title>
  <link href="./styles/index.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous" async></script>
  <link rel="shortcut icon" href="./assets/images/sonolus.ico" type="image/x-icon" />
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark p-2 mb-2">
    <a class="navbar-brand" href="/">
    <img
      src="./assets/images/sonolus.png"
      alt="SonoLite"
      width="30"
      height="30"
      class="d-inline-block align-text-top"
      />
      SonoLite
    </a>
    <div class="verticalSpacer"></div>
    <a class="nav-link" href="/">Home</a>
    <a class="nav-link" href="/levels">Score List</a>
    <a class="nav-link" href="/add">Add Score</a>
    <a class="nav-link" href="/editor">Score Editor</a>
  </nav>
  <div class="container">
    <h2>Sonolus Test Server</h2>
    <hr>
    <h2>Options</h2>
    <p>Make sure to click "Keep" at the top or bottom of the page to save any changes you make.</p>
    <p style="color:red;">Items with red text aren't working properly.</p>
    <div class="card p-4 m-2 w-100">
      <div class="container px-1">
        <div class="row gx-5">
          <div class="col">
            <button class="btn btn-primary" onclick="saveConfig()">Keep</button>
            <hr>
            <h4>Server Settings</h4>
            <p>These settings are for the physical server seen in the Sonolus app.</p>
            <div class="row gx-5">
              <div class="col">
                <!-- Add: Server title, Server skins, Server backgrounds, Server particles, Server effects, Server engines, Server banners -->
                <div>
                  <label for="server-title" class="form-label">Server Title</label>
                  <input type="text" id="server-title" class="form-control" placeholder="<%= defaultConfig.serverSettings.serverTitle %>" value="<%= config.serverSettings.serverTitle %>">
                </div>
              </div>
            </div>
            <br>
            <div class="row gx-5" style="display:none;">
              <div class="col">
                <div>
                  <label for="server-skins" class="form-label" style="color:red;">Server Skins</label>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-skins-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-skins-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-skins">
                    <% config.serverSettings.serverSkins.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item %>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
              <div class="col">
                <div>
                  <label for="server-backgrounds" class="form-label" style="color:red;">Server Backgrounds</label>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-backgrounds-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-backgrounds-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-backgrounds">
                    <% config.serverSettings.serverBackgrounds.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item %>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
            </div>
            <br>
            <div class="row gx-5" style="display:none;">
              <div class="col">
                <div>
                  <label for="server-particles" class="form-label" style="color:red;">Server Particles</label>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-particles-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-particles-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-particles">
                    <% config.serverSettings.serverParticles.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item %>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
              <div class="col">
                <div>
                  <label for="server-effects" class="form-label" style="color:red;">Server Effects</label>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-effects-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-effects-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-effects">
                    <% config.serverSettings.serverEffects.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item %>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
            </div>
            <br>
            <div class="row gx-5">
              <div class="col" style="display:none;">
                <div>
                  <label for="server-engines" class="form-label" style="color:red;">Server Engines</label>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-engines-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-engines-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-engines">
                    <% config.serverSettings.serverEngines.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <%= item %>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
              <div class="col">
                <div>
                  <label for="server-banners" class="form-label">Server Banners</label>
                  <p><strong>This setting will automatically update!</strong></p>
                  <div class="form-group d-flex">
                    <input type="text" class="form-control flex-grow-1" id="server-banners-input">
                    <button type="button" class="btn btn-primary ml-2" id="server-banners-add">Add</button>
                  </div>
                  <ul class="list-group" id="server-banners">
                    <% config.serverSettings.serverBanners.forEach(function(item, index) { %>
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div class="form-check">
                          <% if (index == config.serverSettings.selectedBannerIndex) { %>
                            <input type="radio" class="form-check-input" name="item" id="item<%= index %>" data-index="<%= index %>" checked>
                          <% } else { %>
                            <input type="radio" class="form-check-input" name="item" id="item<%= index %>" data-index="<%= index %>">
                          <% } %>
                          <label class="form-check-label" for="item<%= index %>" id="label<%= item %>" style="display:none;"><%= item %></label>
                          <button type="button" class="btn btn-primary btn-sm" data-index="<%= index %>" data-bs-toggle="modal" data-bs-target="#imageModal" id="view<%= item %>" onclick="updateImageModal(document.getElementById('label<%= item %>'))">View</button>
                        </div>
                        <p>Click to view or edit server banner.</p>
                        <button type="button" class="btn btn-danger btn-sm" data-index="<%= index %>">&times;</button>
                      </li>
                    <% }); %>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <hr>
        <div class="row gx-5">
          <div class="col">
            <h4>General</h4>
            <div>
              <label for="port" class="form-label">* Port</label>
              <input type="text" class="form-control" id="port" placeholder="<%= defaultConfig.port %>" value="<%= config.port %>">
            </div>
            <br>
            <div>
              <label for="downloadPath" class="form-label">* Download Path</label>
              <input type="text" class="form-control" id="downloadPath" placeholder="<%= defaultConfig.downloadPath %>" value="<%= config.downloadPath %>">
            </div>
            <hr>
            <h4>Authentication</h4>
            <div>
              <label for="ppe" class="form-label">Enable Password Protection</label>
              <% if (config.passwordProtectionEnabled) { %>
                <input type="checkbox" class="form-check-input" id="ppe" checked>
              <% } else { %>
                <input type="checkbox" class="form-check-input" id="ppe">
              <% } %>
            </div>
            <div>
              <input type="hidden" id="pwd" name="pwd">
              <input type="hidden" id="pwdChanged" name="pwdChanged" changed="false">
              <label for="pwdButton" class="form-label">Password</label>
              <% if (config.passwordProtectionEnabled) { %>
                <button class="btn btn-primary" id="pwdButton" onclick="changePassword()">Change Password</button>
              <% } else { %>
                <button class="btn btn-primary" id="pwdButton" disabled>Change Password</button>
              <% } %>
            </div>
          </div>
          <div class="col">
            <h4>File Limits</h4>
            <div>
              <label for="jacketLimit" class="form-label">* Jacket Size (MB)</label>
              <input class="form-control" type="number" id="jacketLimit" min="1" max="100" value="<%= config.fileLimits.jacketLimit %>">
            </div>
            <div>
              <label for="musicLimit" class="form-label">* BGM Size (MB)</label>
              <input class="form-control" type="number" id="musicLimit" min="1" max="100" value="<%= config.fileLimits.musicLimit %>">
            </div>
            <div>
              <label for="dataLimit" class="form-label">* Data Size (MB)</label>
              <input class="form-control" type="number" id="dataLimit" min="1" max="100" value="<%= config.fileLimits.dataLimit %>">
            </div>
          </div>
        </div>
        <hr>
        <div>
          <p>* Settings marked with an asterisk (*) will be reflected after restarting.</p>
          <p>Setting file: <%= file %></p>
          <button class="btn btn-primary" onclick="saveConfig()">Keep</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalLabel">Image</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <img src="" id="modal-image" width="100%" height="auto">
          <div class="form-group d-flex">
            <br>
            <input type="text" class="form-control flex-grow-1" id="modal-input">
            <input type="hidden" id="modal-prev" value="">
            <button type="button" class="btn btn-primary ml-2" id="modal-update" data-bs-dismiss="modal" onclick="updateEntry()">Update</button>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <script src="./scripts/index.js"></script>
</body>

</html>